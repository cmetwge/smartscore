<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>QA Snapshot – Instant Call-Quality Reports</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://js.stripe.com/v3/"></script>
  <style>
    :root{--primary:#0052ff;--primary-dark:#0039cb;--grey:#f7f8fc;--text:#111322;--danger:#e60023;
           font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;}
    *{box-sizing:border-box;margin:0;padding:0;}
    body{background:var(--grey);color:var(--text);line-height:1.6;}
    .container{max-width:580px;margin:auto;padding:2rem 1.5rem;}
    h1{font-size:2rem;margin-bottom:.5rem;font-weight:700;}
    .sub{font-size:1.1rem;color:#555;margin-bottom:1.5rem;}
    .card{background:#fff;border-radius:12px;padding:2rem;box-shadow:0 4px 18px rgba(0,0,0,.06);}
    label{display:block;font-weight:600;margin-bottom:.25rem;font-size:.9rem;}
    input[type=email],input[type=text],input[type=file]{
      width:100%;padding:.75rem 1rem;border:1px solid #ddd;border-radius:8px;font-size:1rem;margin-bottom:1rem;
    }
    input[type=file]{padding:.5rem;}
    .btn{
      display:inline-block;background:var(--primary);color:#fff;padding:.9rem 1.5rem;border:none;border-radius:8px;font-size:1.05rem;font-weight:600;cursor:pointer;width:100%;text-align:center;transition:background .2s;
    }
    .btn:hover{background:var(--primary-dark);}
    .note{font-size:.85rem;color:#666;margin-top:.75rem;text-align:center;}
    #msg{margin-top:1rem;font-weight:600;text-align:center;}
    .success{color:green;}
    .error{color:var(--danger);}
  </style>
</head>
<body>
  <div class="container">
    <h1>Instant QA Reports for Contact-Center Calls</h1>
    <p class="sub">Upload up to 50 call recordings. Pay securely, then get a polished QA PDF in about five minutes—no software to install.</p>

    <div class="card">
      <form id="upForm">
        <label for="email">Business email</label>
        <input type="email" id="email" placeholder="you@company.com" required>

        <label for="company">Company name</label>
        <input type="text" id="company" placeholder="Acme Call Center" required>

        <label for="files">Call recordings or chat transcripts</label>
        <input type="file" id="files" multiple accept="audio/*,.txt" required>

        <button type="button" id="payBtn" class="btn">Pay & Generate Report</button>
        <div class="note">Secure payment handled by Stripe.</div>
      </form>
      <div id="msg"></div>
    </div>
  </div>

<script>
const stripe = Stripe('pk_test_YOUR_PUBLISHABLE_KEY'); // ➊ replace with real pk_test_ or pk_live_
const form   = document.getElementById("upForm");
const msg    = document.getElementById("msg");
const btn    = document.getElementById("payBtn");

btn.addEventListener("click", async () => {
  const email   = document.getElementById("email").value;
  const company = document.getElementById("company").value;
  const files   = document.getElementById("files").files;

  if (!email || !company || files.length === 0) {
    msg.innerHTML = '<span class="error">Please complete all fields and select files.</span>';
    return;
  }

  msg.innerHTML = 'Contacting Stripe…';
  // ask backend to create checkout session
  const {sessionId} = await (await fetch("/create-checkout-session", {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({email, company, fileCount: files.length})
  })).json();

  // open stripe popup (embedded)
  const {error} = await stripe.redirectToCheckout({sessionId});
  if (error) {
    msg.innerHTML = '<span class="error">' + error.message + '</span>';
  } else {
    // on success stripe closes popup → we upload
    submitFiles();
  }
});

// after payment confirmed, upload files
async function submitFiles() {
  const data = new FormData(form);
  msg.innerHTML = 'Payment successful—building PDF…';
  const res = await fetch("/upload", {method: "POST", body: data});
  const j   = await res.json();
  msg.innerHTML = '<span class="success">' + (j.detail || 'Done! Check email.') + '</span>';
}
</script>
</body>
</html>
